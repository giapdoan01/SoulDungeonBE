// src-backend/colyseus.ext.ts
import { Room, ClientState } from "@colyseus/core";
async function applyMonkeyPatch() {
  let z = void 0;
  try {
    z = await import("zod");
  } catch (e) {
  }
  const _onJoin = Room.prototype["_onJoin"];
  Room.prototype["_onJoin"] = async function(client) {
    const result = await _onJoin.apply(this, arguments);
    if (client.state === ClientState.JOINING) {
      const messages = {};
      Object.keys(this["onMessageEvents"].events).sort().forEach((type) => {
        if (type.indexOf("__") === 0 || type === "*") {
          return;
        }
        const messageValidator = this["onMessageValidators"][type];
        messages[type] = z && messageValidator && z.toJSONSchema(messageValidator) || null;
      });
      client.send("__playground_message_types", messages);
    }
    return result;
  };
}
export {
  applyMonkeyPatch
};
