{
  "version": 3,
  "sources": ["../src-backend/index.ts"],
  "sourcesContent": ["import path from 'path';\nimport express, { Router } from 'express';\nimport { auth, JWT } from '@colyseus/auth';\nimport { matchMaker, IRoomCache, __globalEndpoints } from '@colyseus/core';\nimport type { Endpoint } from \"@colyseus/better-call\";\nimport { applyMonkeyPatch } from './colyseus.ext.js';\n\nimport { fileURLToPath } from 'url'; // required for ESM build (see build.mjs)\n\nexport type AuthConfig = {\n  oauth: string[],\n  register: boolean,\n  anonymous: boolean,\n};\n\nexport function playground(): Router {\n  applyMonkeyPatch();\n\n  const router = express.Router();\n\n  // serve static frontend\n  router.use(\"/\", express.static(path.resolve(path.dirname(fileURLToPath(import.meta.url)), \"..\", \"build\")));\n\n  // expose matchmaking stats\n  router.get(\"/rooms\", async (req, res) => {\n    const rooms = await matchMaker.driver.query({});\n\n    const roomsByType: { [roomName: string]: number } = {};\n    const roomsById: { [roomName: string]: IRoomCache } = {};\n\n    rooms.forEach((room) => {\n      if (!roomsByType[room.name]) { roomsByType[room.name] = 0; }\n      roomsByType[room.name]++;\n      roomsById[room.roomId] = room;\n    });\n\n    res.json({\n      rooms: Object.keys(matchMaker.getAllHandlers()),\n\n      roomsByType,\n      roomsById,\n\n      auth: {\n        // list of OAuth providers\n        oauth: Object.keys(auth.oauth.providers),\n        register: typeof(auth.settings.onRegisterWithEmailAndPassword) === \"function\",\n        anonymous: typeof(JWT.settings.secret) === \"string\",\n      } as AuthConfig\n    });\n  });\n\n  // serve API docs for playground\n  // (workaround to use better-call route inside express.Router)\n  router.get(\"/__apidocs\", async (_, res) => {\n    /**\n     * Optional: if zod is available, we can use toJSONSchema() for body and query types\n     */\n    let z: any = undefined;\n    try { z = await import(\"zod\"); } catch (e: any) { /* zod not installed  */ }\n\n    res.json(Object.values(__globalEndpoints).map((endpoint: Endpoint) => {\n      return {\n        method: endpoint.options.method,\n        path: endpoint.path,\n        body: z && endpoint.options.body && z.toJSONSchema(endpoint.options.body),\n        query: z && endpoint.options.query && z.toJSONSchema(endpoint.options.query),\n        metadata: endpoint.options.metadata,\n        description: endpoint.options.metadata?.openapi?.description,\n      };\n    }));\n  });\n\n  return router;\n}\n"],
  "mappings": ";AAAA,OAAO,UAAU;AACjB,OAAO,aAAyB;AAChC,SAAS,MAAM,WAAW;AAC1B,SAAS,YAAwB,yBAAyB;AAE1D,SAAS,wBAAwB;AAEjC,SAAS,qBAAqB;AAQvB,SAAS,aAAqB;AACnC,mBAAiB;AAEjB,QAAM,SAAS,QAAQ,OAAO;AAG9B,SAAO,IAAI,KAAK,QAAQ,OAAO,KAAK,QAAQ,KAAK,QAAQ,cAAc,YAAY,GAAG,CAAC,GAAG,MAAM,OAAO,CAAC,CAAC;AAGzG,SAAO,IAAI,UAAU,OAAO,KAAK,QAAQ;AACvC,UAAM,QAAQ,MAAM,WAAW,OAAO,MAAM,CAAC,CAAC;AAE9C,UAAM,cAA8C,CAAC;AACrD,UAAM,YAAgD,CAAC;AAEvD,UAAM,QAAQ,CAAC,SAAS;AACtB,UAAI,CAAC,YAAY,KAAK,IAAI,GAAG;AAAE,oBAAY,KAAK,IAAI,IAAI;AAAA,MAAG;AAC3D,kBAAY,KAAK,IAAI;AACrB,gBAAU,KAAK,MAAM,IAAI;AAAA,IAC3B,CAAC;AAED,QAAI,KAAK;AAAA,MACP,OAAO,OAAO,KAAK,WAAW,eAAe,CAAC;AAAA,MAE9C;AAAA,MACA;AAAA,MAEA,MAAM;AAAA;AAAA,QAEJ,OAAO,OAAO,KAAK,KAAK,MAAM,SAAS;AAAA,QACvC,UAAU,OAAO,KAAK,SAAS,mCAAoC;AAAA,QACnE,WAAW,OAAO,IAAI,SAAS,WAAY;AAAA,MAC7C;AAAA,IACF,CAAC;AAAA,EACH,CAAC;AAID,SAAO,IAAI,cAAc,OAAO,GAAG,QAAQ;AAIzC,QAAI,IAAS;AACb,QAAI;AAAE,UAAI,MAAM,OAAO,KAAK;AAAA,IAAG,SAAS,GAAP;AAAA,IAA0C;AAE3E,QAAI,KAAK,OAAO,OAAO,iBAAiB,EAAE,IAAI,CAAC,aAAuB;AACpE,aAAO;AAAA,QACL,QAAQ,SAAS,QAAQ;AAAA,QACzB,MAAM,SAAS;AAAA,QACf,MAAM,KAAK,SAAS,QAAQ,QAAQ,EAAE,aAAa,SAAS,QAAQ,IAAI;AAAA,QACxE,OAAO,KAAK,SAAS,QAAQ,SAAS,EAAE,aAAa,SAAS,QAAQ,KAAK;AAAA,QAC3E,UAAU,SAAS,QAAQ;AAAA,QAC3B,aAAa,SAAS,QAAQ,UAAU,SAAS;AAAA,MACnD;AAAA,IACF,CAAC,CAAC;AAAA,EACJ,CAAC;AAED,SAAO;AACT;",
  "names": []
}
