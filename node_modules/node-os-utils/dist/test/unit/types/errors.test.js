"use strict";
/**
 * é”™è¯¯å¤„ç†å•å…ƒæµ‹è¯•
 * æµ‹è¯•é”™è¯¯ç±»åž‹ã€é”™è¯¯ç å’Œé”™è¯¯å¤„ç†æœºåˆ¶
 */
Object.defineProperty(exports, "__esModule", { value: true });
const chai_1 = require("chai");
const errors_1 = require("../../../src/types/errors");
describe('Error Handling Unit Tests', function () {
    describe('ErrorCodeæžšä¸¾', function () {
        it('åº”è¯¥åŒ…å«æ‰€æœ‰é¢„æœŸçš„é”™è¯¯ç ', function () {
            const expectedCodes = [
                'PLATFORM_NOT_SUPPORTED',
                'COMMAND_FAILED',
                'PARSE_ERROR',
                'PERMISSION_DENIED',
                'TIMEOUT',
                'INVALID_CONFIG',
                'NOT_AVAILABLE',
                'FILE_NOT_FOUND',
                'NETWORK_ERROR'
            ];
            expectedCodes.forEach(code => {
                (0, chai_1.expect)(errors_1.ErrorCode).to.have.property(code);
                (0, chai_1.expect)(errors_1.ErrorCode[code]).to.be.a('string');
            });
        });
        it('é”™è¯¯ç åº”è¯¥æ˜¯å­—ç¬¦ä¸²ç±»åž‹', function () {
            Object.values(errors_1.ErrorCode).forEach(code => {
                (0, chai_1.expect)(code).to.be.a('string');
                (0, chai_1.expect)(code.length).to.be.greaterThan(0);
            });
        });
    });
    describe('MonitorErroråˆ›å»º', function () {
        it('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºåŸºæœ¬çš„MonitorError', function () {
            const error = new errors_1.MonitorError('Test error message', errors_1.ErrorCode.COMMAND_FAILED, 'test-platform');
            (0, chai_1.expect)(error.code).to.equal(errors_1.ErrorCode.COMMAND_FAILED);
            (0, chai_1.expect)(error.message).to.equal('Test error message');
            (0, chai_1.expect)(error.platform).to.equal('test-platform');
            (0, chai_1.expect)(error.name).to.equal('MonitorError');
            (0, chai_1.expect)(error).to.be.instanceof(Error);
        });
        it('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºåŒ…å«è¯¦ç»†ä¿¡æ¯çš„MonitorError', function () {
            const details = {
                command: 'ps aux',
                exitCode: 1,
                stderr: 'Permission denied'
            };
            const error = new errors_1.MonitorError('Failed to execute command', errors_1.ErrorCode.PERMISSION_DENIED, 'linux', details);
            (0, chai_1.expect)(error.details).to.deep.equal(details);
            (0, chai_1.expect)(error.code).to.equal(errors_1.ErrorCode.PERMISSION_DENIED);
            (0, chai_1.expect)(error.platform).to.equal('linux');
        });
    });
    describe('é™æ€å·¥åŽ‚æ–¹æ³•', function () {
        it('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºå¹³å°ä¸æ”¯æŒé”™è¯¯', function () {
            const error = errors_1.MonitorError.createPlatformNotSupported('win32', 'temperature');
            (0, chai_1.expect)(error.code).to.equal(errors_1.ErrorCode.PLATFORM_NOT_SUPPORTED);
            (0, chai_1.expect)(error.platform).to.equal('win32');
            (0, chai_1.expect)(error.message).to.include('temperature');
            (0, chai_1.expect)(error.details).to.have.property('feature', 'temperature');
        });
        it('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºå‘½ä»¤æ‰§è¡Œå¤±è´¥é”™è¯¯', function () {
            const error = errors_1.MonitorError.createCommandFailed('linux', 'ps aux', { exitCode: 1 });
            (0, chai_1.expect)(error.code).to.equal(errors_1.ErrorCode.COMMAND_FAILED);
            (0, chai_1.expect)(error.platform).to.equal('linux');
            (0, chai_1.expect)(error.message).to.include('ps aux');
            (0, chai_1.expect)(error.details).to.have.property('command', 'ps aux');
            (0, chai_1.expect)(error.details).to.have.property('exitCode', 1);
        });
        it('åº”è¯¥èƒ½å¤Ÿåˆ›å»ºè§£æžé”™è¯¯', function () {
            const error = errors_1.MonitorError.createParseError('darwin', 'invalid data', 'malformed JSON');
            (0, chai_1.expect)(error.code).to.equal(errors_1.ErrorCode.PARSE_ERROR);
            (0, chai_1.expect)(error.platform).to.equal('darwin');
            (0, chai_1.expect)(error.message).to.include('malformed JSON');
            (0, chai_1.expect)(error.details).to.have.property('data', 'invalid data');
            (0, chai_1.expect)(error.details).to.have.property('reason', 'malformed JSON');
        });
    });
    describe('é”™è¯¯åºåˆ—åŒ–', function () {
        it('åº”è¯¥èƒ½å¤Ÿåºåˆ—åŒ–ä¸ºJSON', function () {
            const error = new errors_1.MonitorError('Serialization test', errors_1.ErrorCode.COMMAND_FAILED, 'test', { extra: 'data' });
            const json = error.toJSON();
            (0, chai_1.expect)(json).to.have.property('name', 'MonitorError');
            (0, chai_1.expect)(json).to.have.property('message', 'Serialization test');
            (0, chai_1.expect)(json).to.have.property('code', errors_1.ErrorCode.COMMAND_FAILED);
            (0, chai_1.expect)(json).to.have.property('platform', 'test');
            (0, chai_1.expect)(json).to.have.property('details');
            (0, chai_1.expect)(json.details).to.deep.equal({ extra: 'data' });
        });
        it('åº”è¯¥èƒ½å¤Ÿå®Œæ•´åºåˆ—åŒ–åˆ°JSONå­—ç¬¦ä¸²', function () {
            const error = new errors_1.MonitorError('JSON string test', errors_1.ErrorCode.TIMEOUT, 'network');
            const jsonString = JSON.stringify(error);
            const parsed = JSON.parse(jsonString);
            (0, chai_1.expect)(parsed.name).to.equal('MonitorError');
            (0, chai_1.expect)(parsed.message).to.equal('JSON string test');
            (0, chai_1.expect)(parsed.code).to.equal(errors_1.ErrorCode.TIMEOUT);
            (0, chai_1.expect)(parsed.platform).to.equal('network');
        });
    });
    describe('é”™è¯¯æ¯”è¾ƒå’ŒåŒ¹é…', function () {
        it('åº”è¯¥èƒ½å¤Ÿæ¯”è¾ƒé”™è¯¯ç±»åž‹', function () {
            const error1 = new errors_1.MonitorError('First error', errors_1.ErrorCode.TIMEOUT, 'cpu');
            const error2 = new errors_1.MonitorError('Second error', errors_1.ErrorCode.TIMEOUT, 'memory');
            const error3 = new errors_1.MonitorError('Third error', errors_1.ErrorCode.PERMISSION_DENIED, 'cpu');
            (0, chai_1.expect)(error1.code).to.equal(error2.code);
            (0, chai_1.expect)(error1.code).to.not.equal(error3.code);
            (0, chai_1.expect)(error1.platform).to.equal(error3.platform);
            (0, chai_1.expect)(error1.platform).to.not.equal(error2.platform);
        });
        it('åº”è¯¥èƒ½å¤ŸåŒ¹é…é”™è¯¯æ¨¡å¼', function () {
            const errors = [
                new errors_1.MonitorError('CPU timeout', errors_1.ErrorCode.TIMEOUT, 'cpu'),
                new errors_1.MonitorError('Memory access denied', errors_1.ErrorCode.PERMISSION_DENIED, 'memory'),
                new errors_1.MonitorError('Disk command failed', errors_1.ErrorCode.COMMAND_FAILED, 'disk'),
                new errors_1.MonitorError('Network timeout', errors_1.ErrorCode.TIMEOUT, 'network')
            ];
            // æ‰¾å‡ºæ‰€æœ‰è¶…æ—¶é”™è¯¯
            const timeoutErrors = errors.filter(error => error.code === errors_1.ErrorCode.TIMEOUT);
            (0, chai_1.expect)(timeoutErrors).to.have.length(2);
            // æ‰¾å‡ºæ‰€æœ‰CPUç›¸å…³é”™è¯¯
            const cpuErrors = errors.filter(error => error.platform === 'cpu');
            (0, chai_1.expect)(cpuErrors).to.have.length(1);
            (0, chai_1.expect)(cpuErrors[0].code).to.equal(errors_1.ErrorCode.TIMEOUT);
        });
    });
    describe('è¾¹ç•Œæƒ…å†µ', function () {
        it('åº”è¯¥å¤„ç†ç©ºæ¶ˆæ¯', function () {
            const error = new errors_1.MonitorError('', errors_1.ErrorCode.PARSE_ERROR, 'test');
            (0, chai_1.expect)(error.message).to.equal('');
            (0, chai_1.expect)(error.code).to.equal(errors_1.ErrorCode.PARSE_ERROR);
        });
        it('åº”è¯¥å¤„ç†ç‰¹æ®Šå­—ç¬¦', function () {
            const specialMessage = 'Error with ç‰¹æ®Šå­—ç¬¦ and Ã©mojis ðŸš«';
            const error = new errors_1.MonitorError(specialMessage, errors_1.ErrorCode.INVALID_CONFIG, 'test');
            (0, chai_1.expect)(error.message).to.equal(specialMessage);
        });
        it('åº”è¯¥å¤„ç†é•¿é”™è¯¯æ¶ˆæ¯', function () {
            const longMessage = 'A'.repeat(1000);
            const error = new errors_1.MonitorError(longMessage, errors_1.ErrorCode.COMMAND_FAILED, 'test');
            (0, chai_1.expect)(error.message).to.equal(longMessage);
            (0, chai_1.expect)(error.message.length).to.equal(1000);
        });
        it('åº”è¯¥å¤„ç†å¤æ‚çš„è¯¦ç»†ä¿¡æ¯å¯¹è±¡', function () {
            const complexDetails = {
                nested: {
                    object: true,
                    array: [1, 2, 3],
                    null_value: null,
                    undefined_value: undefined
                }
            };
            (0, chai_1.expect)(() => {
                new errors_1.MonitorError('Complex details', errors_1.ErrorCode.INVALID_CONFIG, 'test', complexDetails);
            }).to.not.throw();
        });
    });
    describe('é”™è¯¯ç»§æ‰¿', function () {
        it('åº”è¯¥æ­£ç¡®ç»§æ‰¿Errorç±»', function () {
            const error = new errors_1.MonitorError('Inheritance test', errors_1.ErrorCode.COMMAND_FAILED, 'test');
            (0, chai_1.expect)(error).to.be.instanceof(Error);
            (0, chai_1.expect)(error).to.be.instanceof(errors_1.MonitorError);
            (0, chai_1.expect)(error.name).to.equal('MonitorError');
            (0, chai_1.expect)(error.stack).to.be.a('string');
        });
    });
    describe('å¤šè¯­è¨€é”™è¯¯æ¶ˆæ¯', function () {
        it('åº”è¯¥æ”¯æŒä¸åŒè¯­è¨€çš„é”™è¯¯æ¶ˆæ¯', function () {
            const messages = {
                en: 'File not found',
                zh: 'æ–‡ä»¶æœªæ‰¾åˆ°',
                ja: 'ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
                fr: 'Fichier non trouvÃ©'
            };
            Object.entries(messages).forEach(([lang, message]) => {
                const error = new errors_1.MonitorError(message, errors_1.ErrorCode.FILE_NOT_FOUND, 'file-system');
                (0, chai_1.expect)(error.message).to.equal(message);
                (0, chai_1.expect)(error.code).to.equal(errors_1.ErrorCode.FILE_NOT_FOUND);
            });
        });
    });
});
//# sourceMappingURL=errors.test.js.map